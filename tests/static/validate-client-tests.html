<html>
    <head>
        <title>Client-side tests for validator...</title>

        <!-- jQuery -->
        <script type="text/javascript" src="/modules/infusion/src/lib/jquery/core/js/jquery.js"></script>

        <!-- Fluid dependencies -->
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/FluidDocument.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/Fluid.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/FluidPromises.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/FluidDOMUtilities.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/FluidIoC.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/DataBinding.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/FluidView.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/lib/fastXmlPull/js/fastXmlPull.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/renderer/js/fluidParser.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/renderer/js/fluidRenderer.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/FluidRequests.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/ModelTransformation.js"></script>
        <script type="text/javascript" src="/modules/infusion/src/framework/core/js/ModelTransformationTransforms.js"></script>


        <!-- Client-side parser dependencies -->
        <script type="text/javascript" src="/modules/json-schema-ref-parser/dist/ref-parser.js"></script>
        <script src="/src/js/common/parser.js"></script>

        <!-- Client-side validator dependencies -->
        <!-- browserified AJV dependency -->
        <script type="text/javascript" src="/content/js/ajv.bundle.js"></script>
        <script src="/src/js/common/validate.js"></script>
    </head>
    <body>
        <p>This page instantiates a client-side validator, which we will exercise using Zombie.  This page must be hosted using gpii.express or another web server.</p>

        <script type="text/javascript">
            var clientValidator = gpii.schema.validator({
                model: {
                    schemas: {
                        base: {
                            "$schema": "http://json-schema.org/draft-04/schema#",
                            "id":      "base.json#",
                            "title":   "Example Schema",
                            "type":    "object",
                            "definitions": {
                                "required": {
                                    "type": "boolean"
                                },
                                "boolean": {
                                    "type": "boolean"
                                },
                                "date": {
                                    "type":   "string",
                                            "format": "date"
                                },
                                "number": {
                                    "type":     "number",
                                            "minValue": 1,
                                            "maxValue": 10
                                },
                                "array": {
                                    "type": "array",
                                            "items": {"type": "boolean" }
                                },
                                "regex": {
                                    "type":    "string",
                                            "pattern": "^v.l.d$"
                                },
                                "password": {
                                    "allOf": [
                                        { "type": "string", "description": "The password must be at least 8 characters long.", "minLength": 8 },
                                        { "type": "string", "description": "The password must have at least one uppercase letter.", "pattern": "[A-Z]+"},
                                        { "type": "string", "description": "The password must have at least one lowercase letter.", "pattern": "[a-z]+"},
                                        { "type": "string", "description": "The password must have at least one number or special character.", "pattern": "[^a-zA-Z]"}
                                    ]
                                }
                            },
                            "properties": {
                                "required": { "$ref": "#/definitions/required" },
                                "boolean":  { "$ref": "#/definitions/boolean" },
                                "date":     { "$ref": "#/definitions/date"},
                                "number":   { "$ref": "#/definitions/number"},
                                "array":    { "$ref": "#/definitions/array"},
                                "password": { "$ref": "base#/definitions/password"},
                                "regex":    { "$ref": "#/definitions/regex"}
                            },
                            "required": ["required"]
                        },
                        derived: {
                            "$schema":     "http://json-schema.org/draft-04/schema#",
                            "title":       "Schema derived from base schema",
                            "description": "inheritance in JSON Schema v4 is still weird.  This example is the one we test against, and it works with JSON Schema.",
                            "type":        "object",
                            "properties": {
                                "required": { "$ref": "base#/definitions/required" },
                                "boolean":  { "$ref": "base#/definitions/boolean" },
                                "date":     { "$ref": "base#/definitions/date"},
                                "number":   { "$ref": "base#/definitions/number"},
                                "array":    { "$ref": "base#/definitions/array"},
                                "regex":    { "$ref": "base#/definitions/array"},

                                "additionalOptional": {
                                    "type": "string"
                                },
                                "additionalRequired": {
                                    "type": "boolean"
                                }
                            },
                            "required": ["additionalRequired", "required"]
                        },
                        deep: {
                            "$schema": "http://json-schema.org/draft-04/schema#",
                            "title": "Deep schema to test variable nesting and paths.",
                            "type":  "object",
                            "properties": {
                                "deep": {
                                    "type": "object",
                                    "properties": {
                                        "required": {
                                            "type": "boolean"
                                        }
                                    },
                                    "required": ["required"]
                                }
                            }
                        },
                        escaped: {
                            "$schema": "http://json-schema.org/draft-04/schema#",
                            "title": "Schema to test names that would otherwise conflict with the path handling",
                            "type":  "object",
                            "properties": {
                                "this.that": {
                                    "type": "object",
                                    "properties": {
                                        "th'other": {
                                            "type": "object",
                                            "description": "How do increasingly sloppy variable names make you feel?",
                                            "properties": {
                                                "required": {
                                                    "type": "boolean"
                                                }
                                            },
                                            "required": ["required"]
                                        }
                                    },
                                    "required": ["th'other"]
                                },
                                "[x][x]": {
                                    "type": "string",
                                    "description": "How do textual cross marks make you feel?"
                                }
                            },
                            "required" : ["[x][x]"]
                        }
                    }
                }
            });
        </script>
    </body>
</html>